<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>í´ë˜ìŠ¤ ëª¬ìŠ¤í„° í‚¤ìš°ê¸°</title>
  <!-- ê·€ì—¬ìš´ í°íŠ¸ (ì„ íƒ ì‚¬í•­) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Baloo 2", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #ffe4f2, #e1f3ff, #fff8dd);
      color: #333;
    }

    .app-container {
      width: min(480px, 95vw);
      background: rgba(255, 255, 255, 0.9);
      border-radius: 24px;
      padding: 24px 20px 28px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.12);
      text-align: center;
      border: 3px solid #ffd8f0;
      position: relative;
      overflow: hidden;
    }

    .app-container::before {
      content: "";
      position: absolute;
      width: 220px;
      height: 220px;
      background: radial-gradient(circle, #fff3c4 0, #ffdfeb 45%, transparent 70%);
      top: -80px;
      right: -60px;
      opacity: 0.7;
      z-index: -1;
    }

    .title-area {
      margin-bottom: 10px;
    }

    .badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 12px;
      background: #fff4c3;
      color: #f28f3b;
      border: 1px dashed #f6b15c;
      margin-bottom: 4px;
    }

    h1 {
      font-size: 26px;
      margin-bottom: 4px;
      color: #444;
    }

    .class-name {
      font-size: 15px;
      color: #777;
      margin-bottom: 12px;
    }

    .monster-wrapper {
      margin: 10px auto 16px;
      width: 220px;
      height: 220px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #ffffff 0, #ffe6ff 35%, #ffe9c8 70%);
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
      border: 4px solid #ffe0ff;
      position: relative;
    }

    .monster-wrapper::after {
      content: "â˜…";
      position: absolute;
      font-size: 20px;
      top: 12px;
      right: 20px;
      color: #ffd54f;
      transform: rotate(-10deg);
    }

    .monster-wrapper::before {
      content: "â™¥";
      position: absolute;
      font-size: 18px;
      bottom: 14px;
      left: 18px;
      color: #ff9aa2;
      transform: rotate(8deg);
    }

    .monster-image {
      width: 150px;
      height: 150px;
      object-fit: contain;
    }

    .level-label {
      font-size: 14px;
      margin-bottom: 2px;
      color: #666;
    }

    .cookie-info {
      font-size: 15px;
      margin-bottom: 8px;
    }

    .cookie-info span {
      font-weight: 700;
      color: #ff7b7b;
    }

    .progress-container {
      margin: 8px auto 4px;
      width: 100%;
      max-width: 360px;
      background: #ffeefb;
      border-radius: 999px;
      padding: 4px;
      border: 2px solid #ffcde6;
      box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.7);
    }

    .progress-bar {
      height: 18px;
      border-radius: 999px;
      background: linear-gradient(90deg, #ffb6c1, #ffde7d, #a4e4ff);
      width: 0%;
      transition: width 0.4s ease-out;
    }

    .progress-text {
      font-size: 13px;
      margin-top: 4px;
      color: #555;
    }

    .status-row {
      margin-top: 10px;
      display: flex;
      justify-content: center;
      gap: 12px;
      font-size: 13px;
      color: #666;
      flex-wrap: wrap;
    }

    .status-pill {
      background: #f1f5ff;
      border-radius: 999px;
      padding: 4px 10px;
      border: 1px solid #d1ddff;
    }

    .footer {
      margin-top: 14px;
      font-size: 11px;
      color: #999;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }

    .last-updated {
      font-size: 11px;
    }

    .error-message {
      margin-top: 6px;
      font-size: 12px;
      color: #e57373;
    }

    .reload-button {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: none;
      background: #ffd6e8;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.15s ease;
      box-shadow: 0 2px 0 rgba(230, 134, 173, 0.5);
    }

    .reload-button:hover {
      background: #ffc2df;
    }

    .reload-button:active {
      transform: translateY(1px);
      box-shadow: 0 1px 0 rgba(230, 134, 173, 0.7);
    }

    .loading-dot {
      display: inline-block;
      font-size: 11px;
      color: #999;
    }

    @media (max-width: 480px) {
      .app-container {
        padding: 18px 16px 22px;
      }

      .monster-wrapper {
        width: 200px;
        height: 200px;
      }

      .monster-image {
        width: 135px;
        height: 135px;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="title-area">
      <div class="badge">ğŸª í´ë˜ìŠ¤ ëª¬ìŠ¤í„° í‚¤ìš°ê¸°</div>
      <h1>ìš°ë¦¬ ë°˜ ëª¬ìŠ¤í„°</h1>
      <div class="class-name" id="classNameLabel">ë‚´ ë°˜ ì´ë¦„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>

    <div class="monster-wrapper">
      <!-- ì¿ í‚¤ ê°œìˆ˜ì— ë”°ë¼ ë°”ë€ŒëŠ” ëª¬ìŠ¤í„° ì´ë¯¸ì§€ -->
      <img
        src="images/egg.png"
        alt="ê·€ì—¬ìš´ ëª¬ìŠ¤í„°"
        class="monster-image"
        id="monsterImage"
      />
    </div>

    <div class="level-label" id="levelLabel">ë ˆë²¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

    <!-- í˜„ì¬ ì¿ í‚¤ì™€ ë‹¤ìŒ ë ˆë²¨ê¹Œì§€ ë‚¨ì€ ì¿ í‚¤ ì„¤ëª… -->
    <div class="cookie-info" id="cookieInfo">
      í˜„ì¬ ì¿ í‚¤: <span>0ê°œ</span>, ë‹¤ìŒ ë ˆë²¨ê¹Œì§€ <span>0ê°œ</span>
    </div>

    <!-- ì§„í–‰ ë°” -->
    <div class="progress-container">
      <div class="progress-bar" id="progressBar"></div>
    </div>
    <div class="progress-text" id="progressText">0% ë‹¬ì„±</div>

    <div class="status-row">
      <div class="status-pill" id="rangeLabel">0 ~ 99ê°œ êµ¬ê°„</div>
      <div class="status-pill" id="statusPill">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>

    <div class="error-message" id="errorMessage" style="display:none;"></div>

    <div class="footer">
      <span class="last-updated" id="lastUpdated">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: -</span>
      <span>
        <button class="reload-button" id="reloadButton">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        <span class="loading-dot" id="loadingDot" style="display:none;">(ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘)</span>
      </span>
    </div>
  </div>

  <script>
    // ==========================
    // ì„¤ì • ì˜ì—­ (ì—¬ê¸°ë§Œ ìˆ˜ì •í•˜ë©´ ë¨)
    // ==========================

    // 1) ë‹¤í–ˆë‹ˆ Open API í‚¤ë¥¼ ì—¬ê¸°ì— ì…ë ¥
    const API_KEY = 'f74167d39b995ffc669e2a0f1732a53684dcb9d4fd14c826';

    // 2) ìš°ë¦¬ ë°˜ ì´ë¦„ (APIì—ì„œ ë°›ì€ nameê³¼ ì¼ì¹˜í•˜ë„ë¡ ì„¤ì •)
    //    ì´ ê°’ê³¼ ì¼ì¹˜í•˜ëŠ” í•™ê¸‰ì„ ì°¾ì•„ì„œ ì‚¬ìš©, ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ í•™ê¸‰ ì‚¬ìš©
    const CLASS_NAME = '3í•™ë…„ 1ë°˜';

    // 3) API ì—”ë“œí¬ì¸íŠ¸ URL
    const API_URL = 'https://api.dahandin.com/openapi/v1/get/class/list';

    // 4) ì£¼ê¸°ì  ìƒˆë¡œê³ ì¹¨ ê°„ê²© (ms) - ìš”êµ¬ì‚¬í•­: 10ì´ˆ
    const REFRESH_INTERVAL_MS = 10_000;

    // ==========================
    // DOM ìš”ì†Œ ìºì‹±
    // ==========================
    const monsterImageEl = document.getElementById('monsterImage');
    const classNameLabelEl = document.getElementById('classNameLabel');
    const levelLabelEl = document.getElementById('levelLabel');
    const cookieInfoEl = document.getElementById('cookieInfo');
    const progressBarEl = document.getElementById('progressBar');
    const progressTextEl = document.getElementById('progressText');
    const rangeLabelEl = document.getElementById('rangeLabel');
    const statusPillEl = document.getElementById('statusPill');
    const errorMessageEl = document.getElementById('errorMessage');
    const lastUpdatedEl = document.getElementById('lastUpdated');
    const reloadButtonEl = document.getElementById('reloadButton');
    const loadingDotEl = document.getElementById('loadingDot');

    // ==========================
    // ìœ í‹¸ í•¨ìˆ˜ë“¤
    // ==========================

    /**
     * í˜„ì¬ ì¿ í‚¤ ê°œìˆ˜(totalCookies)ì— ë”°ë¼
     * ëª¬ìŠ¤í„° ì´ë¯¸ì§€, ë ˆë²¨, êµ¬ê°„ ì •ë³´ë¥¼ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜
     */
    function getMonsterState(totalCookies) {
      let imagePath = 'images/egg.png';
      let levelText = 'ì•Œ(egg) ë‹¨ê³„';
      let rangeText = '0 ~ 99ê°œ êµ¬ê°„';
      let minForThisLevel = 0;
      let nextLevelAt = 100; // ë‹¤ìŒ ë ˆë²¨ ëª©í‘œ ì¿ í‚¤ ìˆ˜

      if (totalCookies >= 1000) {
        imagePath = 'images/level4.png';
        levelText = 'ë ˆë²¨ 4 (ìµœê³  ë ˆë²¨!)';
        rangeText = '1000ê°œ ì´ìƒ';
        minForThisLevel = 1000;
        nextLevelAt = null; // ìµœê³  ë ˆë²¨
      } else if (totalCookies >= 600) {
        imagePath = 'images/level3.png';
        levelText = 'ë ˆë²¨ 3';
        rangeText = '600 ~ 999ê°œ êµ¬ê°„';
        minForThisLevel = 600;
        nextLevelAt = 1000;
      } else if (totalCookies >= 300) {
        imagePath = 'images/level2.png';
        levelText = 'ë ˆë²¨ 2';
        rangeText = '300 ~ 599ê°œ êµ¬ê°„';
        minForThisLevel = 300;
        nextLevelAt = 600;
      } else if (totalCookies >= 100) {
        imagePath = 'images/level1.png';
        levelText = 'ë ˆë²¨ 1';
        rangeText = '100 ~ 299ê°œ êµ¬ê°„';
        minForThisLevel = 100;
        nextLevelAt = 300;
      } else {
        // 0 ~ 99
        imagePath = 'images/egg.png';
        levelText = 'ì•Œ(egg) ë‹¨ê³„';
        rangeText = '0 ~ 99ê°œ êµ¬ê°„';
        minForThisLevel = 0;
        nextLevelAt = 100;
      }

      return {
        imagePath,
        levelText,
        rangeText,
        minForThisLevel,
        nextLevelAt
      };
    }

    /**
     * ì§„í–‰ ë°”(%) ê³„ì‚°
     * - í˜„ì¬ ë ˆë²¨ êµ¬ê°„ ë‚´ì—ì„œ ì–¼ë§ˆë‚˜ ì±„ì› ëŠ”ì§€ ë³´ì—¬ì¤Œ
     */
    function calculateProgressPercent(totalCookies, minForThisLevel, nextLevelAt) {
      if (nextLevelAt === null) {
        // ìµœê³  ë ˆë²¨ì¸ ê²½ìš° í•­ìƒ 100%
        return 100;
      }
      const range = nextLevelAt - minForThisLevel;
      if (range <= 0) return 0;
      const valueInRange = totalCookies - minForThisLevel;
      const ratio = Math.max(0, Math.min(1, valueInRange / range));
      return Math.round(ratio * 100);
    }

    /**
     * ìˆ«ìë¥¼ í•œêµ­ì‹ ì„¸ ìë¦¬ ì½¤ë§ˆë¡œ í¬ë§·íŒ…
     */
    function formatNumber(num) {
      return num.toLocaleString('ko-KR');
    }

    /**
     * ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ í…ìŠ¤íŠ¸ ìƒì„±
     */
    function formatLastUpdated(date) {
      const pad = (n) => (n < 10 ? '0' + n : n);
      const y = date.getFullYear();
      const m = pad(date.getMonth() + 1);
      const d = pad(date.getDate());
      const hh = pad(date.getHours());
      const mm = pad(date.getMinutes());
      const ss = pad(date.getSeconds());
      return `${y}-${m}-${d} ${hh}:${mm}:${ss}`;
    }

    // ==========================
    // UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    // ==========================

    /**
     * APIì—ì„œ ë°›ì•„ì˜¨ í•™ê¸‰ ë°ì´í„°ë¡œ
     * í™”ë©´(ëª¬ìŠ¤í„°, ì§„í–‰ë°”, í…ìŠ¤íŠ¸)ì„ ê°±ì‹ 
     */
    function updateUIWithClassData(classData) {
      const { name, totalCookies = 0 } = classData;

      const state = getMonsterState(totalCookies);
      const percent = calculateProgressPercent(
        totalCookies,
        state.minForThisLevel,
        state.nextLevelAt
      );

      // ì´ë¯¸ì§€ ë³€ê²½
      monsterImageEl.src = state.imagePath;

      // í•™ê¸‰ ì´ë¦„
      classNameLabelEl.textContent = name || 'í•™ê¸‰ ì´ë¦„ ì—†ìŒ';

      // ë ˆë²¨ í…ìŠ¤íŠ¸
      levelLabelEl.textContent = state.levelText;

      // ì¿ í‚¤ ì •ë³´, ë‹¤ìŒ ë ˆë²¨ê¹Œì§€ ë‚¨ì€ ì¿ í‚¤ ìˆ˜ ê³„ì‚°
      let remainingText;
      if (state.nextLevelAt === null) {
        remainingText = 'ì´ë¯¸ ìµœê³  ë ˆë²¨ì´ì—ìš”! ğŸ‰';
      } else {
        const remain = Math.max(0, state.nextLevelAt - totalCookies);
        remainingText = `ë‹¤ìŒ ë ˆë²¨ê¹Œì§€ ${formatNumber(remain)}ê°œ`;
      }

      cookieInfoEl.innerHTML = `í˜„ì¬ ì¿ í‚¤: <span>${formatNumber(
        totalCookies
      )}ê°œ</span>, ${remainingText}`;

      // ì§„í–‰ ë°”
      progressBarEl.style.width = `${percent}%`;
      progressTextEl.textContent = `${percent}% ë‹¬ì„±`;

      // êµ¬ê°„ ë¼ë²¨
      rangeLabelEl.textContent = state.rangeText;

      // ìƒíƒœ ë¼ë²¨
      if (totalCookies === 0) {
        statusPillEl.textContent = 'ì‹œì‘ ë‹¨ê³„, ì¿ í‚¤ ëª¨ìœ¼ê¸° ì¶œë°œ! ğŸ£';
      } else if (state.nextLevelAt === null) {
        statusPillEl.textContent = 'ìµœê³  ë ˆë²¨ ë‹¬ì„±! ê³„ì† ì¿ í‚¤ë¥¼ ëª¨ì•„ë´ìš” âœ¨';
      } else {
        statusPillEl.textContent = 'ìš°ë¦¬ ë°˜ì´ ì¿ í‚¤ë¥¼ ì—´ì‹¬íˆ ëª¨ìœ¼ëŠ” ì¤‘ì´ì—ìš” ğŸ’ª';
      }

      // ì—ëŸ¬ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
      errorMessageEl.style.display = 'none';
      errorMessageEl.textContent = '';

      // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„
      lastUpdatedEl.textContent = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${formatLastUpdated(new Date())}`;
    }

    /**
     * ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í™”ë©´ì— í‘œì‹œ
     */
    function showError(message) {
      errorMessageEl.style.display = 'block';
      errorMessageEl.textContent = message;
      statusPillEl.textContent = 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ë¬¸ì œê°€ ìˆì–´ìš” ğŸ˜¢';
    }

    /**
     * ë¡œë”© ìƒíƒœ í‘œì‹œ
     */
    function setLoading(isLoading) {
      if (isLoading) {
        loadingDotEl.style.display = 'inline';
        reloadButtonEl.disabled = true;
        reloadButtonEl.textContent = 'ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
      } else {
        loadingDotEl.style.display = 'none';
        reloadButtonEl.disabled = false;
        reloadButtonEl.textContent = 'ğŸ”„ ìƒˆë¡œê³ ì¹¨';
      }
    }

    // ==========================
    // API í˜¸ì¶œ í•¨ìˆ˜
    // ==========================

    /**
     * ë‹¤í–ˆë‹ˆ Open APIì—ì„œ í•™ê¸‰ ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì™€
     * ìš°ë¦¬ ë°˜(totalCookies í¬í•¨) ì •ë³´ë¥¼ ë°˜í™˜
     */
    async function fetchClassData() {
      try {
        setLoading(true);

        const response = await fetch(API_URL, {
          method: 'GET',
          headers: {
            'X-API-Key': API_KEY
          }
        });

        if (!response.ok) {
          throw new Error(`API ì‘ë‹µ ì˜¤ë¥˜ (HTTP ${response.status})`);
        }

        const json = await response.json();

        // ë°ì´í„° êµ¬ì¡°: { data: [ { name: "3í•™ë…„ 2ë°˜", totalCookies: 120, ... } ] }
        const list = Array.isArray(json.data) ? json.data : [];

        if (list.length === 0) {
          throw new Error('API ì‘ë‹µì— í•™ê¸‰ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        }

        // CLASS_NAMEê³¼ ì¼ì¹˜í•˜ëŠ” í•™ê¸‰ ì°¾ê¸°, ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ í•™ê¸‰ ì‚¬ìš©
        let classData = list.find((item) => item.name === CLASS_NAME);
        if (!classData) {
          classData = list[0];
        }

        updateUIWithClassData(classData);
      } catch (err) {
        console.error(err);
        showError(err.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      } finally {
        setLoading(false);
      }
    }

    // ==========================
    // ì´ˆê¸°í™” ë° ì£¼ê¸°ì  ì—…ë°ì´íŠ¸ ì„¤ì •
    // ==========================

    document.addEventListener('DOMContentLoaded', () => {
      // í˜ì´ì§€ ë¡œë“œ ì‹œ í•œ ë²ˆ ì¦‰ì‹œ í˜¸ì¶œ
      fetchClassData();

      // ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼
      reloadButtonEl.addEventListener('click', () => {
        fetchClassData();
      });

      // 10ì´ˆë§ˆë‹¤ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸
      setInterval(() => {
        fetchClassData();
      }, REFRESH_INTERVAL_MS);
    });
  </script>
</body>
</html>
